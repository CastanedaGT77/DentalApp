<mat-card class="cardWithShadow mb-4">
  <div class="flex items-center mb-5 cursor-pointer hover:underline" (click)="returnPage()">
    <mat-icon fontIcon="west"></mat-icon>
    <p class="ml-2">Regresar</p>
  </div>
  <mat-card-header class="flex items-center space-x-4">
    <div class="w-20 h-20 rounded-full overflow-hidden bg-gray-200">
      <img [src]="sanitizedImage" alt="Patient Image" class="w-full h-full object-cover">
    </div>
    <div>
      <h2 class="text-xl font-semibold">Paciente: {{ paciente.firstName }} {{ paciente.lastName }}</h2>
      <p class="text-gray-600">Edad: {{ paciente.birthDate | date }}</p>
    </div>
  </mat-card-header>
  <mat-card-content class="space-y-4">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <p><strong>Números de Contacto:</strong> {{ paciente.phoneNumber }} - {{ paciente.cellPhoneNumber }}</p>
      <p><strong>Correo Electrónico:</strong> {{ paciente.email }}</p>
      <p><strong>Ciudad:</strong> {{ paciente.city }}</p>
      <p><strong>Dirección:</strong> {{ paciente.address }}</p>
      <p><strong>Recomendado por:</strong> {{ paciente.recommendedBy }}</p>
      <p><strong>Persona a Cargo:</strong> {{ paciente.personInCharge }}</p>
      <p><strong>Estado Civil:</strong> {{ paciente.maritalStatus }}</p>
      <p><strong>Ocupación:</strong> {{ paciente.occupation }}</p>
      <p><strong>Doctor Personal:</strong> {{ paciente.personalDoctor }}</p>
      <p><strong>Dentista Previo:</strong> {{ paciente.previousDentist }}</p>
    </div>
  </mat-card-content>
</mat-card>

<mat-card class="cardWithShadow mb-4">
  <mat-card-content>
    <h3 class="text-lg font-semibold mb-2">Detalle de Enfermedad:</h3>
    <div *ngFor="let detail of paciente.illnessDetails; let i = index" class="mb-4">
      <p class="text-gray-700"><strong>{{ i + 1 }}. Nombre:</strong> {{ detail.name }}</p>
      <p class="text-gray-500"><strong>Descripción:</strong> {{ detail.description }}</p>
    </div>
  </mat-card-content>
</mat-card>

<mat-card class="cardWithShadow mb-4">
  <mat-card-content>
    <div class="flex justify-between items-center mb-4">
      <div>
        <mat-card-title>Historial de Planes de Tratamientos</mat-card-title>
      </div>
    </div>
    <mat-accordion>
      <mat-expansion-panel *ngFor="let treatment of treatmentDataSource.data" [expanded]="treatment.expanded">
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ treatment.name }}
          </mat-panel-title>
          <mat-panel-description>
            {{ treatment.description }}
          </mat-panel-description>
        </mat-expansion-panel-header>
        <div *ngFor="let detail of treatment.treatmentDetails">
          <br>
          <p><strong>{{ detail.treatmentType.name }}</strong></p>
          <p>{{ detail.treatmentType.description }}</p>
          <p><strong>Pieza:</strong> {{ detail.piece }}</p>
          <p><strong>Precio sugerido:</strong> {{ detail.suggestedPrice }}</p>
          <p><strong>Precio real:</strong> {{ detail.realPrice }}</p>
          <p><strong>Estado de pago:</strong> {{ detail.paymentStatus ? 'Pagado' : 'Pendiente' }}</p>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </mat-card-content>
</mat-card>

<mat-card class="cardWithShadow mb-4">
  <mat-card-content>
    <div class="flex justify-between items-center mb-4">
      <div>
        <mat-card-title>Historial de citas</mat-card-title>
      </div>
    </div>
    <mat-form-field class="w-full mb-4">
      <mat-label>Buscar</mat-label>
      <input matInput (keyup)="applyFilter2($event)">
    </mat-form-field>
    <table mat-table [dataSource]="appointmentDataSource" class="w-full">
      <!-- Fecha Column -->
      <ng-container matColumnDef="appointmentDate">
        <th mat-header-cell *matHeaderCellDef> Fecha </th>
        <td mat-cell *matCellDef="let appointment"> {{ appointment.appointmentDate }} </td>
      </ng-container>
      <!-- Hora de Inicio Column -->
      <ng-container matColumnDef="startHour">
        <th mat-header-cell *matHeaderCellDef> Hora de Inicio </th>
        <td mat-cell *matCellDef="let appointment"> {{ appointment.startHour }} </td>
      </ng-container>
      <!-- Hora de Fin Column -->
      <ng-container matColumnDef="endHour">
        <th mat-header-cell *matHeaderCellDef> Hora de Fin </th>
        <td mat-cell *matCellDef="let appointment"> {{ appointment.endHour }} </td>
      </ng-container>
      <!-- Estado Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef> Estado </th>
        <td mat-cell *matCellDef="let appointment">
          <span [ngClass]="{ 'bg-light-error text-error': appointment.status === 0, 'bg-light-accent text-accent': appointment.status === 1 }" class="rounded f-w-600 p-6 p-y-4 f-s-12">
            {{ appointment.status === 0 ? 'Pendiente' : 'Completada' }}
          </span>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedAppointmentColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedAppointmentColumns;"></tr>
    </table>
    <mat-paginator [pageSize]="1" showFirstLastButtons></mat-paginator>
  </mat-card-content>
</mat-card>

<mat-card class="cardWithShadow p-6 mb-4 flex justify-end">
  <mat-card-actions>
    <button mat-raised-button color="primary" (click)="returnPage()">Regresar</button>
  </mat-card-actions>
</mat-card>

<ngx-spinner type="ball-scale-multiple"></ngx-spinner>
